var _this = this;
var React = require("react");
var enzyme_1 = require("enzyme");
var Pagination_tsx_1 = require("../src/Pagination.tsx");
var core_1 = require("../../../../core");
var TestHelpers_1 = require("../../../__test__/TestHelpers");
describe("Pagination tests", function () {
    beforeEach(function () {
        _this.searchkit = core_1.SearchkitManager.mock();
        _this.searchkit.addDefaultQuery(function (query) {
            return query.setSize(10);
        });
        _this.createWrapper = function (showNumbers, pageScope) {
            if (showNumbers === void 0) { showNumbers = true; }
            if (pageScope === void 0) { pageScope = 3; }
            _this.wrapper = enzyme_1.mount(React.createElement(Pagination_tsx_1.Pagination, {"searchkit": _this.searchkit, "showNumbers": showNumbers, "pageScope": pageScope, "translations": { "pagination.previous": "Previous Page" }}));
            _this.accessor = _this.searchkit.accessors.statefulAccessors["p"];
        };
        _this.searchkit.query = new core_1.ImmutableQuery().setSize(10);
        _this.searchkit.setResults({
            hits: {
                total: 80
            }
        });
    });
    describe("rendering", function () {
        beforeEach(function () {
            _this.checkActionStates = function (page, prevDisabled, nextDisabled, pages) {
                _this.accessor.state = _this.accessor.state.setValue(page);
                _this.wrapper.update();
                expect(_this.wrapper.find(".sk-pagination-navigation-item__prev")
                    .hasClass("is-disabled")).toBe(prevDisabled);
                expect(_this.wrapper.find(".sk-pagination-navigation-item__next")
                    .hasClass("is-disabled")).toBe(nextDisabled);
                var pageNumbers = _this.wrapper.find(".sk-pagination-navigation-item__number");
                expect(pageNumbers.map(function (e) { return e.text(); })).toEqual(pages);
                // Check links
                pageNumbers.forEach(function (e, idx) {
                    if (e.text() !== '...') {
                        expect(e.html()).toContain('"/context.html?p=' + pages[idx] + '"');
                    }
                });
            };
        });
        it("renders text", function () {
            _this.createWrapper();
            expect(_this.wrapper.find(".sk-pagination-navigation-item__prev").text()).toBe("Previous Page");
            expect(_this.wrapper.find(".sk-pagination-navigation-item__next").text()).toBe("Next");
        });
        it("renders with pages", function () {
            _this.createWrapper();
            expect(_this.wrapper.html()).toEqual(TestHelpers_1.jsxToHTML(React.createElement("div", {"className": "sk-pagination-navigation is-numbered", "data-qa": "pagination"}, React.createElement("div", {"className": "sk-pagination-navigation-item sk-pagination-navigation__item sk-pagination-navigation-item__prev is-disabled"}, React.createElement("div", {"className": "sk-pagination-navigation-item__text"}, "Previous Page")), React.createElement("a", {"className": "sk-pagination-navigation-item sk-pagination-navigation__item sk-pagination-navigation-item__number is-active", "href": "/context.html?p=1"}, React.createElement("div", {"className": "sk-pagination-navigation-item__text"}, "1")), React.createElement("a", {"className": "sk-pagination-navigation-item sk-pagination-navigation__item sk-pagination-navigation-item__number", "href": "/context.html?p=2"}, React.createElement("div", {"className": "sk-pagination-navigation-item__text"}, "2")), React.createElement("a", {"className": "sk-pagination-navigation-item sk-pagination-navigation__item sk-pagination-navigation-item__number", "href": "/context.html?p=3"}, React.createElement("div", {"className": "sk-pagination-navigation-item__text"}, "3")), React.createElement("a", {"className": "sk-pagination-navigation-item sk-pagination-navigation__item sk-pagination-navigation-item__number", "href": "/context.html?p=4"}, React.createElement("div", {"className": "sk-pagination-navigation-item__text"}, "4")), React.createElement("div", {"className": "sk-pagination-navigation-item sk-pagination-navigation__item sk-pagination-navigation-item__number is-disabled"}, React.createElement("div", {"className": "sk-pagination-navigation-item__text"}, "...")), React.createElement("a", {"className": "sk-pagination-navigation-item sk-pagination-navigation__item sk-pagination-navigation-item__next", "href": "/context.html?p=2"}, React.createElement("div", {"className": "sk-pagination-navigation-item__text"}, "Next")))));
        });
        it("renders with pages", function () {
            _this.createWrapper(false);
            expect(_this.wrapper.html()).toEqual(TestHelpers_1.jsxToHTML(React.createElement("div", {"className": "sk-pagination-navigation", "data-qa": "pagination"}, React.createElement("div", {"className": "sk-pagination-navigation-item sk-pagination-navigation__item sk-pagination-navigation-item__prev is-disabled"}, React.createElement("div", {"className": "sk-pagination-navigation-item__text"}, "Previous Page")), React.createElement("a", {"className": "sk-pagination-navigation-item sk-pagination-navigation__item sk-pagination-navigation-item__next", "href": "/context.html?p=2"}, React.createElement("div", {"className": "sk-pagination-navigation-item__text"}, "Next")))));
        });
        it('renders first page options', function () {
            _this.createWrapper();
            _this.checkActionStates(null, true, false, ['1', '2', '3', '4', '...']);
        });
        it('renders second page options', function () {
            _this.createWrapper();
            _this.checkActionStates(2, false, false, ['1', '2', '3', '4', '5', '...']);
        });
        it('renders eighth page options', function () {
            _this.createWrapper();
            _this.checkActionStates(8, false, true, ['1', '...', '5', '6', '7', '8']);
        });
        it("handles showNumbers prop", function () {
            _this.createWrapper(false);
            _this.checkActionStates(4, false, false, []);
        });
        it("handles pageScope prop", function () {
            _this.createWrapper(true, 1);
            _this.checkActionStates(4, false, false, ['1', '...', '3', '4', '5', '...']);
        });
        it("renders no pagination on no results", function () {
            _this.searchkit.setResults({ hits: { total: 0 } });
            _this.createWrapper();
            expect(_this.wrapper.find(".sk-pagination-navigation").length).toBe(0);
        });
        it("both disabled on only one total page", function () {
            _this.searchkit.setResults({ hits: { total: 10 } });
            _this.createWrapper();
            expect(_this.wrapper.find(".sk-pagination-navigation").length).toBe(1);
            _this.checkActionStates(1, true, true, ['1']);
            expect(_this.wrapper.find(".sk-pagination-navigation").hasClass("is-disabled")).toBe(true);
        });
    });
    describe("interacting", function () {
        it("interact prev disabled", function () {
            _this.createWrapper();
            _this.accessor.state = _this.accessor.state.setValue(1);
            TestHelpers_1.fastClick(_this.wrapper.find(".sk-pagination-navigation-item__prev"));
            expect(_this.accessor.state.getValue()).toBe(1);
        });
        it("click previous, next", function () {
            _this.createWrapper();
            _this.accessor.state = _this.accessor.state.setValue(3);
            _this.wrapper.update();
            TestHelpers_1.fastClick(_this.wrapper.find(".sk-pagination-navigation-item__prev"));
            expect(_this.accessor.state.getValue()).toBe(2);
            TestHelpers_1.fastClick(_this.wrapper.find(".sk-pagination-navigation-item__next"));
            TestHelpers_1.fastClick(_this.wrapper.find(".sk-pagination-navigation-item__next"));
            expect(_this.accessor.state.getValue()).toBe(4);
        });
        it("ability to click last page", function () {
            _this.createWrapper();
            _this.accessor.state = _this.accessor.state.setValue(7);
            _this.wrapper.update();
            TestHelpers_1.fastClick(_this.wrapper.find(".sk-pagination-navigation-item__next"));
            expect(_this.accessor.state.getValue()).toBe(8);
            TestHelpers_1.fastClick(_this.wrapper.find(".sk-pagination-navigation-item__next"));
            expect(_this.accessor.state.getValue()).toBe(8);
        });
    });
});
//# sourceMappingURL=PaginationSpec.js.map